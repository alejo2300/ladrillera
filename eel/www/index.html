<!DOCTYPE html>
<html>
  <head>
    <title>Gestor Maguncia</title>

    <!-- IMPORTS -->
    <script src="eel.js"></script>

    <!-- JS -->
    <script>
      function link(target) {
        window.location.href = target;
      }

      function handleReportSelected() {
        let report = document.getElementById("reportSelector").value;
        switch (report) {
          case "1":
            //console.log("Prioridad")
            cleanTable();
            getProgramationByPriority();
            break;

          case "2":
            //console.log("Monto")
            cleanTable();
            getProgramationByMount();
            break;

          case "3":
            //console.log("Prioridad*monto")
            cleanTable();
            getProgramationByPriorityMMount();
            break;

          default:
            alert("No se ha selecionado ningun reporte");
        }
      }

      function cleanTable() {
        let tbodyElement = document.querySelector("tbody");
        tbodyElement.innerHTML = "";
      }

      function getProgramationByPriority() {
        eel.getProgramationByPriority();
      }

      function getProgramationByMount() {
        eel.getProgramationByMount();
      }

      function getProgramationByPriorityMMount() {
        eel.getProgramationByPriorityMMount();
      }

      function getProgramationResponse(programationList) {
        let tbodyElement = document.querySelector("tbody");
        let e1, e2, e3, e4;
        for (let i = 0; i < programationList.length; i++) {
          e1 = programationList[i][0];
          e2 = programationList[i][1];
          e3 = programationList[i][2];
          e4 = programationList[i][3];
          e5 = programationList[i][4];
          tbodyElement.innerHTML += `
              <tr>
                <td>${e1}</td>
                <td>${e2}</td>
                <td>${e3}</td>
                <td>${e4}</td>
                <td>${e5}</td>
              </tr>`;
        }
      }
      eel.expose(getProgramationResponse);

      //Gantt Chart

      function createChart(e) {
        const days = document.querySelectorAll(".chart-values li");
        const tasks = document.querySelectorAll(".chart-bars li");
        const daysArray = [...days];
      
        tasks.forEach(el => {
          const duration = el.dataset.duration.split("-");
          const startDay = duration[0];
          const endDay = duration[1];
          let left = 0,
            width = 0;
      
          if (startDay.endsWith("½")) {
            const filteredArray = daysArray.filter(day => day.textContent == startDay.slice(0, -1));
            left = filteredArray[0].offsetLeft + filteredArray[0].offsetWidth / 2;
          } else {
            const filteredArray = daysArray.filter(day => day.textContent == startDay);
            left = filteredArray[0].offsetLeft;
          }
      
          if (endDay.endsWith("½")) {
            const filteredArray = daysArray.filter(day => day.textContent == endDay.slice(0, -1));
            width = filteredArray[0].offsetLeft + filteredArray[0].offsetWidth / 2 - left;
          } else {
            const filteredArray = daysArray.filter(day => day.textContent == endDay);
            width = filteredArray[0].offsetLeft + filteredArray[0].offsetWidth - left;
          }
      
          // apply css
          el.style.left = `${left}px`;
          el.style.width = `${width}px`;
          if (e.type == "load") {
            el.style.backgroundColor = el.dataset.color;
            el.style.opacity = 1;
          }
        });
      }
      
      window.addEventListener("load", createChart);
      window.addEventListener("resize", createChart);
    </script>

    <!-- Import bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <!-- ADD CSS -->
    <link rel="stylesheet" href="css/index.css" />
  </head>

  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Maguncia</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="#"
                onclick="link('index.html')"
                >Menu</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#" onclick="link('clients.html')"
                >Clientes</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#" onclick="link('orders.html')"
                >Ordenes</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#" onclick="link('bricks.html')"
                >Productos</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- End NAVBAR -->

    <!-- CONTENT -->
    <div style="text-align: center" class="titleContent">
      <h1 style="text-align: center">Gestor de producción</h1>

      <p>
        Generar reporte:
        <select id="reportSelector" onchange="handleReportSelected()">
          <option value="0"></option>
          <option value="1">Por prioridad</option>
          <option value="2">Por monto</option>
          <option value="3">Por prioridad*monto</option>
        </select>
      </p>
    </div>

    <!-- Table raw programation-->
    <div class="tableSpace">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Cliente</th>
            <th scope="col">Prioridad</th>
            <th scope="col">Cantidad</th>
            <th scope="col">Producto</th>
            <th scope="col">Tiempo de entrega</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- GANTT CHART -->
    <div class="chart-wrapper">
      <ul class="chart-values">
        <li>sun</li>
        <li>mon</li>
        <li>tue</li>
        <li>wed</li>
        <li>thu</li>
        <li>fri</li>
        <li>sat</li>
        <li>patata</li>
      </ul>
      <ul class="chart-bars">
        <li data-duration="tue½-wed" data-color="#b03532">Task</li>
        <li data-duration="wed-sat" data-color="#33a8a5">Task</li>
        <li data-duration="sun-tue" data-color="#30997a">Task</li>
        <li data-duration="tue½-thu" data-color="#6a478f">Task</li>
        <li data-duration="mon-tue½" data-color="#da6f2b">Task</li>
        <li data-duration="wed-wed" data-color="#3d8bb1">Task</li>
        <li data-duration="thu-fri½" data-color="#e03f3f">Task</li>
        <li data-duration="mon½-wed½" data-color="#59a627">Task</li>
        <li data-duration="fri-patata" data-color="#4464a1">Task</li>
      </ul>
    </div>
    


  </body>
</html>
